<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mark's Image finder</title>
    <!-- <link rel="stylesheet" href="css/style.css"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <!-- Optional theme -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

</head>
<body>
 
<h1>Nasa Image Provider</h1>
<br>
    Search term: <input id='searchBox' value="metal" type="text" name="fname">
    <!-- <button onclick="addImages('x')" >Search</button> -->
    <button id='search' onclick="$('#showMore').prepend('<p></p>');addImages( $('#searchBox').val());$('img').remove();" >Search</button><br><br>
    <a id='showMore' onclick="addImages( $('#searchBox').val());"><br><center>Click here to load more images</center></a>
</body>

<script>
    function addImages(searchTerm){
        //$("#showMore").remove();

        
        //make these global?

        //will redisplay when there were missing images
        let itemID = $('img').length;
        console.log("starting checking images at " + itemID)
        let maxItem = itemID+15;
        //let outerLoop = 0;
        let numItemsRendered = 0;

        $.getJSON("https://images-api.nasa.gov/search?q="+searchTerm, function (imagesJSON){
            while (itemID <30){
                console.log(itemID)


                let image = imagesJSON.collection.items[itemID].href;
                //console.log("outer loop for loop# " + outerLoop + " return is " + image)
                $.getJSON(image, function (imageJSON){

                    console.log(typeof(imageJSON))
                    let i = 0;
                    let url = imageJSON[i];
                    do{
                        if (url.endsWith('.png') || url.endsWith('.img') || url.endsWith('.jpg')){
                            
                            if (numItemsRendered <12){
                                console.log(url + " checks out and is being rendered")
                                appendFileLink(imageJSON[i]);
                                numItemsRendered+=1;
                            }
                            // else{
                            //     $("body").append("<br><a id='showMore'>Click here to load more images</a>")
                            //     //break getPotentialImages;
                            // } 
                            break;//don't check for another filetype of the same file
                        }
                        i+=1; 
                    }while(i < 20)//check the first 20 file types
                });
            
                itemID +=1;
            }
            //$("body").append("<br>")
        });
        //$("body").append("<a id='showMore'>Click here to load more images</a>")
}   


    //function to append a single file to the end of the body
    function appendFileLink(url){
        if (url.endsWith('.png') || url.endsWith('.img') || url.endsWith('.jpg') )
        $("p").append("<img width='32' height='24' src='"+url+"'>")
        // else if (url.endsWith('.mp4') || url.endsWith('.mp3')|| url.endsWith('.wav')) 
        //     $("body").append("<video width='320' height='240' controls> <source src='" +url + "' type='video/mp4'></video>")    
        else 
            console.log("unsupported file type: " + url)
    }

</script>

</html>